import{aU as I,aX as L,ak as k,aY as R,f as W,aZ as N}from"./useDesktop-BQ6h6iOA.js";import{d as C}from"./shared-BkwG8Aos.js";var G=Object.defineProperty,g=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable,z=(t,e,r)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,T=(t,e)=>{for(var r in e||(e={}))S.call(e,r)&&z(t,r,e[r]);if(g)for(var r of g(e))B.call(e,r)&&z(t,r,e[r]);return t},f=(t,e,r)=>new Promise((n,o)=>{var c=i=>{try{A(r.next(i))}catch(p){o(p)}},m=i=>{try{A(r.throw(i))}catch(p){o(p)}},A=i=>i.done?n(i.value):Promise.resolve(i.value).then(c,m);A((r=r.apply(t,e)).next())});const Y="background-image",Z="lazy-loading",D="lazy-error",E="lazy-attempt",M=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],y="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",s=[],u=[],O=C(100),a={loading:y,error:y,attempt:3,throttleWait:300,events:M};let _=L(l,a.throttleWait);function d(t,e){t._lazy.arg===Y?t.style.backgroundImage="url(".concat(e,")"):t.setAttribute("src",e)}function V(t){t._lazy.loading&&d(t,t._lazy.loading),l()}function j(t){t._lazy.error&&d(t,t._lazy.error),t._lazy.state="error",v(t),l()}function w(t,e){d(t,e),t._lazy.state="success",v(t),l()}function U(t){var e;u.includes(t)||(u.push(t),(e=a.events)==null||e.forEach(r=>{t.addEventListener(r,_,{passive:!0})}))}function X(){u.forEach(t=>{var e;(e=a.events)==null||e.forEach(r=>{t.removeEventListener(r,_)})}),u.length=0}function x(t,e){var r,n;const o={loading:(r=t.getAttribute(Z))!=null?r:a.loading,error:(n=t.getAttribute(D))!=null?n:a.error,attempt:t.getAttribute(E)?Number(t.getAttribute(E)):a.attempt};t._lazy=T({src:e.value,arg:e.arg,currentAttempt:0,state:"pending",attemptLock:!1},o),d(t,y),W(a.filter,t._lazy)}function H(t,e){const r=new Image;r.src=e,t._lazy.preloadImage=r,r.addEventListener("load",()=>{t._lazy.attemptLock=!1,O.add(e),w(t,e)}),r.addEventListener("error",()=>{t._lazy.attemptLock=!1,t._lazy.currentAttempt>=t._lazy.attempt?j(t):P(t)})}function P(t){if(t._lazy.attemptLock)return;t._lazy.attemptLock=!0,t._lazy.currentAttempt++;const{src:e}=t._lazy;if(O.has(e)){w(t,e),t._lazy.attemptLock=!1;return}V(t),H(t,e)}function h(t){return f(this,null,function*(){yield k(),R(t)&&P(t)})}function l(){s.forEach(t=>h(t))}function K(t){return f(this,null,function*(){!s.includes(t)&&s.push(t),N(t).forEach(U),yield h(t)})}function v(t){I(s,t),s.length===0&&X()}function Q(t,e){const{src:r,arg:n}=t._lazy;return r!==e.value||n!==e.arg}function b(t,e){return f(this,null,function*(){x(t,e),yield K(t)})}function $(t,e){return f(this,null,function*(){if(!Q(t,e)){s.includes(t)&&(yield h(t));return}yield b(t,e)})}function q(t={}){const{events:e,loading:r,error:n,attempt:o,throttleWait:c,filter:m}=t;a.events=e!=null?e:a.events,a.loading=r!=null?r:a.loading,a.error=n!=null?n:a.error,a.attempt=o!=null?o:a.attempt,a.throttleWait=c!=null?c:a.throttleWait,a.filter=m}const F={mounted:b,unmounted:v,updated:$,install(t,e){q(e),_=L(l,a.throttleWait),t.directive("lazy",this)}};var et=F;export{et as s};
